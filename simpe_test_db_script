DROP TABLE IF EXISTS user_roles;
DROP TABLE IF EXISTS harvest_results;
DROP TABLE IF EXISTS roles;
DROP TABLE IF EXISTS products;
DROP TABLE IF EXISTS users;

CREATE TABLE roles(
	id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(40) NOT NULL
);

CREATE TABLE products(
	id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar(100) NOT NULL,
	count int CHECK (count >= 0),
	unit_type VARCHAR(40) NOT NULL
);

CREATE TABLE users(
	id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name varchar NOT NULL,
	email varchar(80) UNIQUE NOT NULL,
	password varchar NOT NULL
);

CREATE TABLE user_roles(
	user_id int REFERENCES users(id),
	role_id int REFERENCES roles(id),
	PRIMARY KEY (user_id, role_id)
);

CREATE TABLE harvest_results(
	id int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	user_id int REFERENCES users(id),
	product_id int REFERENCES products(id),
	count int CHECK (count >= 0),
	at_moment timestamp NOT NUll
);

ALTER TABLE users
	ADD COLUMN is_locked boolean NOT NULL DEFAULT FALSE;

--- TEST DATA ---
INSERT INTO roles(name) VALUES ('ROLE_WORKER');
INSERT INTO roles(name) VALUES ('ROLE_ADMIN');
INSERT INTO roles(name) VALUES ('ROLE_OWNER');


INSERT INTO products(name, count, unit_type) VALUES ('egg', 20, 'PIECE');
INSERT INTO products(name, count, unit_type) VALUES ('strawberry', 300, 'KILOGRAM');
INSERT INTO products(name, count, unit_type) VALUES ('milk', 10, 'LITER');
-- paswd = workerpass
INSERT INTO users(name, email, password)
VALUES ('worker', 'worker@gmail.com', '$2a$10$qSTXUqHv/deSYhxYW9BrMOFj0ill8nhqUD/xSQJTJOJRM5OOcH75.');

-- paswd = adminpass
INSERT INTO users(name, email, password)
VALUES ('director', 'director@gmail.com', '$2a$10$HC7cST.xW3tM0e14vsd0eOaUM0KL7TRG2olThZXR15HCcusblmexO');

-- paswd = ownerpass
INSERT INTO users(name, email, password)
VALUES ('owner', 'owner@gmail.com', '$2a$10$SawSNhN5IUAKJvKxecscpesXXNp9ksYBezqm9ln7tfKGrHj6AHglu');

-- paswd = blokedworker
INSERT INTO users(name, email, password, is_locked)
VALUES ('blockedworker', 'blocked@gmail.com', '$2a$10$afzSDNdiAJ2TSkQXd0BGvu9sgZ2HEXM.VvoVEV80ox0IRt1/zkWv6', TRUE);

-- paswd = worker2
INSERT INTO users(name, email, password)
VALUES ('worker2', 'worker2@gmail.com', '$2a$10$EShdJ1p.mL/wp44sMChSIOBChFn0NBPvTr2aMq1NS45DCis/DE/JK');

INSERT INTO user_roles VALUES (1, 1);
INSERT INTO user_roles VALUES (2, 2);
INSERT INTO user_roles VALUES (3, 3);
INSERT INTO user_roles VALUES (4, 1);
INSERT INTO user_roles VALUES (5, 1);

INSERT INTO harvest_results(user_id, product_id, count, at_moment) VALUES (1, 1, 10, '2022-05-20 10:40:12');
INSERT INTO harvest_results(user_id, product_id, count, at_moment) VALUES (2, 3, 20, '2012-06-01 9:10:02');
INSERT INTO harvest_results(user_id, product_id, count, at_moment) VALUES (1, 1, 10, '2022-05-20 11:00:28');
INSERT INTO harvest_results(user_id, product_id, count, at_moment) VALUES (1, 2, 300, '2022-05-21 18:10:54');
INSERT INTO harvest_results(user_id, product_id, count, at_moment) VALUES (1, 3, 10, '2022-06-01 9:10:02');

